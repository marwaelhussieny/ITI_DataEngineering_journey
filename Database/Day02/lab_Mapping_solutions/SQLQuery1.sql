CREATE DATABASE mydb;
USE mydb;


CREATE TABLE EMPLOYEE (
    FNAME VARCHAR(20),
    LNAME VARCHAR(20),
    SSN CHAR(9) PRIMARY KEY,
    BDATE DATE,
    ADDRESS VARCHAR(100),
    SEX CHAR(1),
    SALARY DECIMAL(10,2),
    SUPERSSN CHAR(9),
    DNO INT,
    FOREIGN KEY (SUPERSSN) REFERENCES EMPLOYEE(SSN)
);


CREATE TABLE DEPARTMENT (
    DNAME VARCHAR(20),
    DNUMBER INT PRIMARY KEY,
    MGRSSN CHAR(9),
    MGRSTARTDATE DATE,
    FOREIGN KEY (MGRSSN) REFERENCES EMPLOYEE(SSN)
);



CREATE TABLE DEPT_LOCATIONS (
    DNUMBER INT,
    DLOCATION VARCHAR(20),
    PRIMARY KEY (DNUMBER, DLOCATION),
    FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT(DNUMBER)
);




CREATE TABLE PROJECT (
    PNAME VARCHAR(20),
    PNUMBER INT PRIMARY KEY,
    PLOCATION VARCHAR(20),
    DNUM INT,
    FOREIGN KEY (DNUM) REFERENCES DEPARTMENT(DNUMBER)
);



CREATE TABLE WORKS_ON (
    ESSN CHAR(9),
    PNO INT,
    HOURS DECIMAL(4,1),
    PRIMARY KEY (ESSN, PNO),
    FOREIGN KEY (ESSN) REFERENCES EMPLOYEE(SSN),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNUMBER)
);

CREATE TABLE DEPENDENT (
    ESSN CHAR(9),
    DEPENDENT_NAME VARCHAR(20),
    SEX CHAR(1),
    BDATE DATE,
    RELATIONSHIP VARCHAR(20),
    PRIMARY KEY (ESSN, DEPENDENT_NAME),
    FOREIGN KEY (ESSN) REFERENCES EMPLOYEE(SSN)
);


INSERT INTO EMPLOYEE VALUES
('John','Smith','123456789','1985-01-09','Cairo','M',8000,NULL,1),
('Sara','Ali','987654321','1990-03-12','Giza','F',7000,'123456789',2),
('Ahmed','Hassan','456789123','1988-06-20','Alex','M',6500,'123456789',1),
('Mona','Youssef','741852963','1992-09-15','Cairo','F',6000,'987654321',3),
('Omar','Khaled','369258147','1987-11-25','Giza','M',7500,'987654321',2);



INSERT INTO DEPARTMENT VALUES
('IT',1,'123456789','2015-01-01'),
('HR',2,'987654321','2016-05-01'),
('Finance',3,'741852963','2017-03-15'),
('Marketing',4,'456789123','2018-07-10'),
('Sales',5,'369258147','2019-02-20');



INSERT INTO DEPT_LOCATIONS VALUES
(1,'Cairo'),
(2,'Giza'),
(3,'Alex'),
(4,'Cairo'),
(5,'Giza');



INSERT INTO PROJECT VALUES
('Website',101,'Cairo',1),
('Recruitment',102,'Giza',2),
('Budget',103,'Alex',3),
('Campaign',104,'Cairo',4),
('Expansion',105,'Giza',5);


INSERT INTO WORKS_ON VALUES
('123456789',101,20),
('987654321',102,15),
('456789123',101,10),
('741852963',103,25),
('369258147',105,30);


INSERT INTO DEPENDENT VALUES
('123456789','Ali','M','2010-05-10','Son'),
('987654321','Lina','F','2012-08-22','Daughter'),
('456789123','Yara','F','2015-01-30','Daughter'),
('741852963','Adam','M','2018-04-14','Son'),
('369258147','Nour','F','2016-09-18','Daughter');


ALTER TABLE EMPLOYEE
ADD FOREIGN KEY (SUPERSSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE EMPLOYEE
ADD FOREIGN KEY (DNO) REFERENCES DEPARTMENT(DNUMBER);

ALTER TABLE DEPARTMENT
ADD FOREIGN KEY (MGRSSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE DEPT_LOCATIONS
ADD FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT(DNUMBER);

ALTER TABLE PROJECT
ADD FOREIGN KEY (DNUM) REFERENCES DEPARTMENT(DNUMBER);

ALTER TABLE WORKS_ON
ADD FOREIGN KEY (ESSN) REFERENCES EMPLOYEE(SSN),
ADD FOREIGN KEY (PNO) REFERENCES PROJECT(PNUMBER);

ALTER TABLE DEPENDENT
ADD FOREIGN KEY (ESSN) REFERENCES EMPLOYEE(SSN);